image: node:latest

# before_script:
#     - npm i -g firebase-tools

npm:client:
    tags:
        - node
    stage: npm
    artifacts:
        paths:
            - client/node_modules/
        expire_in: 1 days
        when: always

    script:
        - cd client/
        - echo "Running npm ci ..."
        - npm ci
    except:
        - /^backend-.*$/

# lint:client:
#     stage: lint
#     tags:
#         - node
#     script:
#         - cd client/
#         - echo "Linting.."
#         - npm run lint-fix
#     except:
#         - /^backend-*$/

# test:client:
#     stage: test
#     tags:
#         - node
#     script:
#         - cd client/
#         - echo "Testing.."
#         - ./node_modules/.bin/jest ./
#     except:
#         - /^backend-*$/

staging:client:
    stage: staging
    script:
        - cd client
        - CI=false npm run build
        - npm install -g firebase-tools
        - firebase deploy --only functions --token $FIREBASE_TOKEN
        - firebase use --token $FIREBASE_TOKEN staging
        - firebase deploy --only hosting -m "Pipeline $CI_PIPELINE_ID, build $CI_BUILD_ID" --non-interactive --token $FIREBASE_TOKEN
    artifacts:
        paths:
            # Build folder
            - build
        expire_in: 1 hour
    # only:
    #     - development
