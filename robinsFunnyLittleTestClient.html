<html>
    <head> </head>

    <body>
        <h2>Socket.io Test</h2>

        <div id="output"></div>
        <select name="env" id="env">
            <option selected value="localhost:5000">local</option>
            <option value="monstrous-minigames-staging.herokuapp.com">staging</option>
            <option value="monstrous-minigames.herokuapp.com">live</option>
        </select>
        <button onclick="connect()">CONNECT</button>
        <br />
        <br />

        <button onclick="input('start')">START</button>
        <button onclick="input('backToLobby')">BACK TO LOBBY</button>

        <br />
        <button onclick="input('move')">MOVE</button>

        <button onclick="input('obstacleSolved')">SOLVE OBSTACLE</button>
        <br />
        <button onclick="input('stop')">STOP</button>
        <button onclick="input('pause')">PAUSE/RESUME</button>
    </body>

    <!-- test-io-client.html -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
        integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
        crossorigin="anonymous"
    ></script>
    <script>
        function connect() {
            init();
        }
        let userId = '';
        let socket;

        function input(type) {
            if (type == 'start')
                socket.emit('message', {
                    type: 'game1/start',
                });
            if (type == 'move')
                socket.emit('message', {
                    type: 'game1/runForward',
                });
            if (type == 'backToLobby')
                socket.emit('message', {
                    type: 'backToLobby',
                });
            if (type == 'obstacleSolved')
                socket.emit('message', {
                    type: 'game1/obstacleSolved',
                });
            if (type == 'stop')
                socket.emit('message', {
                    type: 'stopGame',
                });
            if (type == 'pause')
                socket.emit('message', {
                    type: 'pauseResume',
                });
        }

        function init() {
            let env = document.getElementById('env').value;
            console.log(env);
            let url = env + '/controller?roomId=ABCDE&name=Robin&userId=';
            let screenUrl = env + '/screen?roomId=ABCDE&name=Robin&userId=';

            socket = io(url, {
                secure: true,
                reconnection: true,
                rejectUnauthorized: false,
                reconnectionDelayMax: 10000,
            });

            const ssocket = io(screenUrl, {
                secure: true,
                reconnection: true,
                rejectUnauthorized: false,
                reconnectionDelayMax: 10000,
            });

            output = document.getElementById('output');
            testSocket();

            function testSocket() {}

            socket.on('connect', onConnect);
            socket.on('disconnect', onDisconnect);
            socket.on('connect_error', onError);
            socket.on('reconnect_error', onError);
            socket.on('response', onResponse);
            socket.on('message', onMessage);
            ssocket.on('message', onMessage);

            function onConnect(evt) {
                writeToScreen('CONNECTED');
                doSend('Allo?');
            }

            function onDisconnect(evt) {
                writeToScreen('DISCONNECTED');
            }
            function onResponse(response) {
                writeToScreen(response);
                console.log(response);
            }

            function onMessage(msg) {
                if (msg.type !== 'game1/gameState') console.log(msg);

                if (msg.type == 'userInit') {
                    userId = msg.userId;
                }
            }

            function onError(message) {
                writeToScreen('<span style="color: red;">ERROR:</span> ' + message);
            }

            function doSend(message) {
                writeToScreen('SENT: ' + message);
                socket.emit('test', message);
            }

            function writeToScreen(message) {
                var pre = document.createElement('p');
                pre.style.wordWrap = 'break-word';
                pre.innerHTML = message;
                output.appendChild(pre);
            }
        }

        //window.addEventListener("load", init, false);
    </script>
</html>
