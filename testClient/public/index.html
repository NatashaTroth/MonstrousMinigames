<html>
  <head> </head>

  <body>
    <h2>Socket.io Test</h2>

    <div id="output"></div>
    <select onchange="changeMode()" name="mode" id="mode">
      <option selected value="local">local</option>
      <option value="live">live</option>
    </select>
    <button onclick="connect()">CONNECT</button>
    <br />
    <br />

    <button onclick="input('start')">START</button>
    <button onclick="input('reset')">RESET</button>

    <br />
    <button onclick="input('move')">MOVE</button>

    <button onclick="input('obstacleSolved')">SOLVE OBSTACLE</button>
  </body>

  <!-- test-io-client.html -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
    integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
    crossorigin="anonymous"
  ></script>
  <script>
    let local = true;
    function changeMode() {
      var e = document.getElementById("mode");
      if (e.value === "local") {
        local = true;
      } else {
        local = false;
      }
    }
    function connect() {
      init(local);
    }
      let userId = "";
    let socket;

    function input(type) {
        if (type == "start")
          socket.emit("message", {
            type: "game1/start",
            roomId: "ABCDE",
            userId: userId,
          });
        if (type == "move")
          socket.emit("message", {
            type: "game1/runForward",
            roomId: "ABCDE",
            userId: userId,
          });
        if (type == "reset")
          socket.emit("message", {
            type: "resetGame",
            roomId: "ABCDE",
            userId: userId,
          });
        if (type == "obstacleSolved")
          socket.emit("message", {
            type: "game1/obstacleSolved",
            roomId: "ABCDE",
            userId: userId,
          });
      }


    function init(local = true) {
      let url = "";
      let screenUrl = "";
      if (local) {
        url = "localhost:5000/controller?roomId=ABCDE&name=Robin&userId=";
        screenUrl = "localhost:5000/screen?roomId=ABCDE&name=Robin&userId=";
      } else {
        url =
          "monstrous-minigames.herokuapp.com/controller?roomId=ABCDE&name=Robin&userId=";

        screenUrl =
          "monstrous-minigames.herokuapp.com/screen?roomId=ABCDE&name=Robin&userId=";
      }


      socket = io(url, {
        secure: true,
        reconnection: true,
        rejectUnauthorized: false,
        reconnectionDelayMax: 10000,
      });

      const ssocket = io(screenUrl, {
        secure: true,
        reconnection: true,
        rejectUnauthorized: false,
        reconnectionDelayMax: 10000,
      });

      output = document.getElementById("output");
      testSocket();

      function testSocket() {}

      socket.on("connect", onConnect);
      socket.on("disconnect", onDisconnect);
      socket.on("connect_error", onError);
      socket.on("reconnect_error", onError);
      socket.on("response", onResponse);
      socket.on("message", onMessage);
      ssocket.on("message", onMessage);

      function onConnect(evt) {
        writeToScreen("CONNECTED");
        doSend("Allo?");
      }

      function onDisconnect(evt) {
        writeToScreen("DISCONNECTED");
      }
      function onResponse(response) {
        writeToScreen(response);
        console.log(response);
      }

      function onMessage(msg) {
        console.log(msg);
        if (msg.type == "userInit") {
          userId = msg.userId;
        }
      }

      function onError(message) {
        writeToScreen('<span style="color: red;">ERROR:</span> ' + message);
      }

      function doSend(message) {
        writeToScreen("SENT: " + message);
        socket.emit("test", message);
      }

      function writeToScreen(message) {
        var pre = document.createElement("p");
        pre.style.wordWrap = "break-word";
        pre.innerHTML = message;
        output.appendChild(pre);
      }
    }

    //window.addEventListener("load", init, false);
  </script>
</html>
